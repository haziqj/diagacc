---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# R/diagacc: Modelling diagnostic errors using latent class models
[![Travis-CI Build Status](https://travis-ci.org/haziqj/diagacc.svg?branch=master)](https://travis-ci.org/haziqj/diagacc)
[![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/haziqj/diagacc?branch=master&svg=true)](https://ci.appveyor.com/project/haziqj/diagacc)
[![Coverage Status](https://img.shields.io/codecov/c/github/haziqj/diagacc/master.svg)](https://codecov.io/github/haziqj/diagacc?branch=master)

This is the `R` package accompanying our paper: *Diagnostic Accuracy for Schistosomiasis: Applications of Latent Class Modelling Approaches With and Without a Gold Standard*. 
There are three models primarily used in this package: latent class model (LC), latent class with random effects model (LCRE), and a finite mixture model (FM).
Details of these models and their use for modelling diagnostic errors are found in the paper.

The package includes functions to

1. Simulate a data set from either the LC, LCRE or FM model.
2. Wrapper functions to fit such models and obtain estimates and standard errors/posterior standard deviations of sensitivities, specificities, prevalence.
    - LC and LCRE models can be fitted using EM algorithm (`randomLCA` package) or MCMC (`JAGS`)
    - FM models are fitted using MCMC (`JAGS`)
3. Functions to perform a simulation study, as per the following:
    - Simulate data based on a certain scenario (sensitivities, specificities, prevalance, proportion of missing gold standard, and data generating mechanism)
    - Fit the data using LC, LCRE and FM models
    - Repeat the above two steps using a different random seed, and results averaged
  The results are shown in tabular form or in a graph.
  
# Installation and setting options

The easiest way to then install from this repo is by using the [devtools](https://github.com/hadley/devtools) package. 
Install this first.

```{r, eval = FALSE}
install.packages("devtools")
```

Then, run the following code to install and attach the `diagacc` package.

```{r, eval = 2}
devtools::install_github("haziqj/diagacc")
library(diagacc)
```

The default number of items is six (including a gold standard item), with the sensitivities and specificities as shown above.
To change this, use the `diagacc_opt()` function.

```{r}
# Change sensitivities, specificities and item names
diagacc_opt(sens = runif(6), spec = runif(6), item.names = LETTERS[1:6])

# Restore default options
diagacc_opt(default = TRUE)
```

# Simulating data sets

The functions to simulate a data set are `gen_lc()`,  `gen_lcre()` and `gen_fm()`.

```{r, cache = TRUE}
# Sample size (n), proportion of missing gold item (miss.prop), and prevalence
# (tau), using a specific random seedmys
X <- gen_lc(n = 1000, miss.prop = 0.5, tau = 0.1, seed = 123)
head(X)
```

# Obtain estimates

The functions for model fitting are `fit_lc()`,  `fit_lcre()` and `fit_fm()`.
The first two of these functions has the option `method = c("EM", "MCMC")`.

```{r, cache = TRUE}
# Fitting a LC model using EM algorithm
(mod1 <- fit_lc(X))
```

```{r, cache = TRUE}
# Fitting a LC model using MCMC
(mod2 <- fit_lc(X, method = "MCMC"))
```

There is also the option for `raw = TRUE`, which return the actual `rjags` or `randomLCA` object for further inspection or manipulation.
This is especially useful for MCMC diagnostics.

```{r, cache = TRUE}
# Running 8 chains in parallel 
mod3 <- fit_lcre(X, method = "MCMC", raw = TRUE, silent = TRUE, n.chains = 8, 
                 runjags.method = "parallel")
plot(mod3, plot.type = "density", layout = c(3, 2), vars = "beta")
```
